subject: Pike 7.8: Timezone data, SSL, 
from: cb765a0af476021b3e53744ef6c6c6b79a13e064
to: 9fc6d5cf19517ccf4efb5f453a6bc4700d5171a4
originator: wellhardh@roxen.com
depends: 2013-08-08T150312
restart: true

Multiple fixes:

  * Calendar.Timezone.Runtime_timezone_compiler: Improve reentrancy.
    
    The runtime timezone compiler was not thread safe, and could
    fail with the compiler error "Undefined identifier forever."
    when multiple concurrent threads compiled the same timezone.
    
    Potentially fixes [bug 6816] #1:1.

  * Tools.Standalone.features: Version and license for Mysql.
    
    The feature listers now know about how to detect MariaDB.

  * MIME: getencoded() should probably never return a StringRange.
    
    (cherry picked from commit 87b47190e06ff9b0f253c1db0350e135f2595a71)

  * Updated to tzdata2013h.

  * Search.Utils: Get rid of the timestamp(len) syntax.
    
    The syntax was ignored in MySQL 4.1, deprecated in MySQL 5.1,
    and removed in MySQL 5.5. Cf MySQL 5.5 Ref Manual 2.12.1.1.

  * SSL: Improved robustness in destroy().
    
    The embedded stream may still be registered with a backend when the
    sslfile object loses its last reference. Make sure not to trigger
    the "In callback mode in a different backend." error in that case.
    
    Fixes [bug 6958].

  * SSL: set_backend(UNDEFINED) is not supported.
    
    Fixes previous commit.

  * SSL: Improved robustness in destroy() take III.
    
    Clearing the backend callbacks is a better approach
    to inhibiting the CHECK_CB_MODE() test.

  * SSL: Some more robustness fixes in destroy().
    
    set_nonblocking_keep_callbacks() calls update_internal_state(),
    which is likely to install callbacks and thus may trigger the
    tests in CHECK_CB_MODE() (cf [bug 6958] #6).
    
    Yet another potential fix for [bug 6958].

  * SSL.sslfile: Improved propagation of write errors.
    
    The write callback needs to be called on write failure
    if there's no close callback and even if there's data
    buffered for writing.
    
    Fixes Stdio.sendfile hanging on SSL.sslfiles where the
    remote has closed the connection before reading all data.
    
    Fixes remainder of [bug 6958].

  * Stdio.sendfile: Fixed typo in start_writer().
    
    The close callback was likely to be cleared when the write callback
    was installed.

  * Updated to tzdata2013i.

  * Thread.Farm: typo in call to cond->wait()

  * Graphics.Graph: Fixed some infinite loops.
    
    The step when assigning the axis lables could be smaller than the
    mantissa allows, which caused infinite cpu and memory consumption.
    
    This state is now detected and the loops terminated.
    
    Fixes [LysLysKOM 20708162].

  * Updated to tzdata2014a.

  * Export: Make sure to display diagnostics on failure.
